<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACCESS ‚Äî An Intersectionality Game</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Unbounded:wght@300;400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #0a0a0a;
    --white: #f5f0e8;
    --red: #e63329;
    --green: #1a8a3c;
    --amber: #d4820a;
    --gray: #3a3a3a;
    --light-gray: #b0a898;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'Space Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ---- SCREEN SYSTEM ---- */
  .screen { display: none; min-height: 100vh; }
  .screen.active { display: flex; flex-direction: column; }

  /* ---- TITLE SCREEN ---- */
  #title-screen {
    background: var(--black);
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px 20px;
    position: relative;
    overflow: hidden;
  }

  #title-screen::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 30px,
      rgba(255,255,255,0.025) 30px,
      rgba(255,255,255,0.025) 31px
    );
  }

  .title-badge {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--red);
    border: 1px solid var(--red);
    padding: 6px 16px;
    margin-bottom: 40px;
    display: inline-block;
  }

  h1.game-title {
    font-family: 'Unbounded', sans-serif;
    font-weight: 900;
    font-size: clamp(64px, 14vw, 140px);
    line-height: 0.85;
    letter-spacing: -4px;
    color: var(--white);
    margin-bottom: 20px;
  }

  h1.game-title span { color: var(--red); }

  .subtitle {
    font-size: 13px;
    letter-spacing: 2px;
    color: var(--light-gray);
    margin-bottom: 60px;
    text-transform: uppercase;
  }

  .crenshaw-credit {
    font-size: 11px;
    color: var(--light-gray);
    margin-bottom: 60px;
    font-style: italic;
  }

  .big-btn {
    font-family: 'Unbounded', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 2px;
    text-transform: uppercase;
    background: var(--red);
    color: var(--white);
    border: none;
    padding: 20px 50px;
    cursor: pointer;
    transition: all 0.15s;
    clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
  }
  .big-btn:hover { background: var(--white); color: var(--red); transform: scale(1.03); }

  /* ---- SHARED LAYOUT ---- */
  .screen-header {
    background: var(--black);
    border-bottom: 1px solid #222;
    padding: 16px 32px;
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .screen-header .logo {
    font-family: 'Unbounded', sans-serif;
    font-weight: 900;
    font-size: 20px;
    letter-spacing: -1px;
  }
  .screen-header .logo span { color: var(--red); }

  .round-indicator {
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--light-gray);
    text-transform: uppercase;
    margin-left: auto;
  }

  /* ---- RULES SCREEN ---- */
  #rules-screen {
    padding: 60px 40px;
    max-width: 900px;
    margin: 0 auto;
    flex-direction: column;
    gap: 40px;
  }
  #rules-screen.active { display: flex; }

  .rules-title {
    font-family: 'Unbounded', sans-serif;
    font-weight: 700;
    font-size: 32px;
    color: var(--white);
  }

  .rule-block {
    border-left: 3px solid var(--red);
    padding-left: 24px;
  }

  .rule-block h3 {
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 1px;
    color: var(--red);
    margin-bottom: 12px;
    text-transform: uppercase;
  }

  .rule-block p, .rule-block li {
    font-size: 13px;
    line-height: 1.8;
    color: var(--light-gray);
  }

  .rule-block ul { list-style: none; }
  .rule-block ul li::before { content: '‚Üí '; color: var(--red); }

  /* ---- SETUP SCREEN ---- */
  #setup-screen {
    padding: 0;
    flex-direction: column;
  }
  #setup-screen.active { display: flex; }

  .setup-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    flex: 1;
  }

  .setup-panel {
    padding: 40px;
    border-right: 1px solid #222;
  }

  .setup-panel:last-child { border-right: none; }

  .panel-label {
    font-size: 10px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--light-gray);
    margin-bottom: 24px;
  }

  .identity-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .identity-card {
    background: #111;
    border: 1px solid #333;
    padding: 16px;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
  }

  .identity-card:hover { border-color: var(--amber); }
  .identity-card.selected { border-color: var(--amber); background: #1a1600; }
  .identity-card.selected::after {
    content: '‚úì';
    position: absolute;
    top: 8px; right: 10px;
    color: var(--amber);
    font-size: 12px;
  }

  .identity-card .cat-label {
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--light-gray);
    margin-bottom: 6px;
  }

  .identity-card .identity-name {
    font-family: 'Unbounded', sans-serif;
    font-size: 12px;
    font-weight: 700;
    color: var(--white);
  }

  .privilege-bar-container {
    margin-top: 8px;
    height: 3px;
    background: #333;
  }

  .privilege-bar {
    height: 100%;
    background: var(--amber);
    transition: width 0.4s;
  }

  .character-preview {
    background: #0d0d0d;
    border: 1px solid #222;
    padding: 24px;
    margin-top: 20px;
  }

  .char-name {
    font-family: 'Unbounded', sans-serif;
    font-size: 18px;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 16px;
  }

  .char-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }

  .char-tag {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 4px 10px;
    border: 1px solid var(--amber);
    color: var(--amber);
  }

  .access-score {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-top: 16px;
  }

  .access-score-label {
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--light-gray);
  }

  .access-score-value {
    font-family: 'Unbounded', sans-serif;
    font-size: 28px;
    font-weight: 900;
    color: var(--amber);
  }

  .players-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 24px;
  }

  .player-row {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #111;
    border: 1px solid #222;
    padding: 12px 16px;
  }

  .player-num {
    font-family: 'Unbounded', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--red);
    width: 24px;
  }

  .player-name-input {
    background: transparent;
    border: none;
    border-bottom: 1px solid #444;
    color: var(--white);
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    padding: 4px 8px;
    flex: 1;
    outline: none;
  }
  .player-name-input:focus { border-bottom-color: var(--amber); }
  .player-name-input::placeholder { color: #444; }

  /* ---- GAME SCREEN ---- */
  #game-screen { flex-direction: column; }
  #game-screen.active { display: flex; }

  .game-layout {
    display: grid;
    grid-template-columns: 280px 1fr 280px;
    flex: 1;
    overflow: hidden;
  }

  .sidebar {
    border-right: 1px solid #1a1a1a;
    padding: 24px;
    overflow-y: auto;
    background: #050505;
  }

  .sidebar:last-child { border-right: none; border-left: 1px solid #1a1a1a; }

  .sidebar-title {
    font-size: 9px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--light-gray);
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid #1a1a1a;
  }

  .player-card {
    background: #0d0d0d;
    border: 1px solid #222;
    padding: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .player-card.active-player { border-color: var(--amber); }
  .player-card.current-turn { border-left: 3px solid var(--red); }

  .player-card-name {
    font-family: 'Unbounded', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 8px;
  }

  .player-tags-mini {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-bottom: 10px;
  }

  .tag-mini {
    font-size: 8px;
    letter-spacing: 1px;
    padding: 2px 6px;
    background: #1a1a1a;
    color: var(--light-gray);
  }

  .score-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .score-label { font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: #555; }
  .score-val { font-family: 'Unbounded', sans-serif; font-size: 16px; font-weight: 700; }
  .score-val.positive { color: var(--green); }
  .score-val.neutral { color: var(--amber); }
  .score-val.negative { color: var(--red); }

  /* Center game area */
  .game-center {
    padding: 32px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .scenario-card {
    background: #0d0d0d;
    border: 1px solid #222;
    padding: 32px;
    position: relative;
  }

  .scenario-card::before {
    content: 'SCENARIO';
    position: absolute;
    top: -1px; left: 24px;
    font-size: 9px;
    letter-spacing: 4px;
    background: var(--red);
    color: var(--white);
    padding: 4px 12px;
    transform: translateY(-50%);
  }

  .scenario-title {
    font-family: 'Unbounded', sans-serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 16px;
    margin-top: 8px;
  }

  .scenario-desc {
    font-size: 13px;
    line-height: 1.8;
    color: var(--light-gray);
    margin-bottom: 24px;
  }

  .discussion-prompt {
    background: #111;
    border-left: 3px solid var(--amber);
    padding: 16px 20px;
    margin-bottom: 24px;
  }

  .discussion-prompt-label {
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 8px;
  }

  .discussion-prompt p {
    font-size: 12px;
    line-height: 1.7;
    color: var(--light-gray);
    font-style: italic;
  }

  .access-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .access-option {
    background: #111;
    border: 1px solid #333;
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }

  .access-option:hover { border-color: var(--white); }
  .access-option.selected-choice { border-color: var(--green); background: #071208; }

  .access-option-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .access-icon {
    font-size: 18px;
  }

  .access-option-name {
    font-family: 'Unbounded', sans-serif;
    font-size: 12px;
    font-weight: 700;
    color: var(--white);
  }

  .access-option-desc {
    font-size: 11px;
    line-height: 1.6;
    color: var(--light-gray);
    margin-bottom: 12px;
  }

  .access-modifiers {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .modifier-row {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .modifier-label { color: #555; }
  .modifier-val.pos { color: var(--green); }
  .modifier-val.neg { color: var(--red); }
  .modifier-val.neu { color: var(--amber); }

  /* Outcome display */
  .outcome-display {
    background: #0d0d0d;
    border: 1px solid #222;
    padding: 24px;
  }

  .outcome-header {
    font-size: 9px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--light-gray);
    margin-bottom: 16px;
  }

  .outcome-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .outcome-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 12px;
    background: #111;
    border-left: 3px solid transparent;
  }

  .outcome-item.gained { border-left-color: var(--green); }
  .outcome-item.lost { border-left-color: var(--red); }
  .outcome-item.blocked { border-left-color: #444; opacity: 0.6; }

  .outcome-badge {
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 3px 8px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .outcome-badge.g { background: var(--green); color: var(--white); }
  .outcome-badge.l { background: var(--red); color: var(--white); }
  .outcome-badge.b { background: #333; color: #777; }

  .outcome-text { font-size: 12px; line-height: 1.6; color: var(--light-gray); }
  .outcome-why { font-size: 10px; color: #555; margin-top: 4px; font-style: italic; }

  /* Timer */
  .timer-bar {
    height: 4px;
    background: #1a1a1a;
    position: relative;
    overflow: hidden;
  }

  .timer-fill {
    height: 100%;
    background: var(--red);
    transition: width 1s linear;
  }

  /* Buttons */
  .action-btn {
    font-family: 'Unbounded', sans-serif;
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 14px 28px;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
    clip-path: polygon(6px 0, 100% 0, calc(100% - 6px) 100%, 0 100%);
  }

  .btn-primary { background: var(--red); color: var(--white); }
  .btn-primary:hover { background: var(--white); color: var(--red); }

  .btn-secondary { background: transparent; color: var(--light-gray); border: 1px solid #333; clip-path: none; }
  .btn-secondary:hover { border-color: var(--white); color: var(--white); }

  .btn-confirm { background: var(--green); color: var(--white); }
  .btn-confirm:hover { background: var(--white); color: var(--green); }

  /* Reflection phase */
  .reflection-box {
    background: #0a0d0a;
    border: 1px solid var(--green);
    padding: 24px;
  }

  .reflection-questions {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .reflection-questions li {
    font-size: 13px;
    line-height: 1.7;
    color: var(--light-gray);
    padding-left: 16px;
    border-left: 2px solid var(--green);
  }

  /* Phase header */
  .phase-bar {
    background: #0a0a0a;
    border-bottom: 1px solid #1a1a1a;
    padding: 12px 32px;
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .phase-steps {
    display: flex;
    gap: 0;
    flex: 1;
  }

  .phase-step {
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 6px 16px;
    color: #444;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
  }

  .phase-step.active { color: var(--amber); border-bottom-color: var(--amber); }
  .phase-step.done { color: var(--green); }

  /* Resources sidebar */
  .resource-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    margin-bottom: 8px;
    background: #0d0d0d;
    border: 1px solid #1a1a1a;
  }

  .resource-icon { font-size: 16px; width: 24px; text-align: center; }
  .resource-name { font-size: 11px; color: var(--light-gray); flex: 1; }
  .resource-status { font-size: 9px; letter-spacing: 1px; text-transform: uppercase; }
  .resource-status.have { color: var(--green); }
  .resource-status.lack { color: #444; }
  .resource-status.partial { color: var(--amber); }

  /* End screen */
  #end-screen { flex-direction: column; align-items: center; justify-content: center; padding: 60px 40px; }
  #end-screen.active { display: flex; }

  .final-scores {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    width: 100%;
    max-width: 900px;
    margin: 40px 0;
  }

  .final-card {
    background: #0d0d0d;
    border: 1px solid #222;
    padding: 24px;
    text-align: center;
  }

  .final-card.winner { border-color: var(--amber); }

  .final-player-name {
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 8px;
  }

  .final-score-big {
    font-family: 'Unbounded', sans-serif;
    font-size: 48px;
    font-weight: 900;
    line-height: 1;
    margin: 16px 0;
  }

  .final-reflection {
    max-width: 700px;
    text-align: center;
  }

  .final-reflection p {
    font-size: 13px;
    line-height: 1.9;
    color: var(--light-gray);
  }

  /* Helpers */
  .flex { display: flex; }
  .gap-12 { gap: 12px; }
  .mt-16 { margin-top: 16px; }
  .mt-24 { margin-top: 24px; }
  .hidden { display: none !important; }

  /* Instructor notes panel */
  .instructor-chip {
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--black);
    background: var(--amber);
    padding: 3px 10px;
    display: inline-block;
    margin-bottom: 12px;
  }
</style>
</head>
<body>

<!-- ============================
     TITLE SCREEN
============================= -->
<div id="title-screen" class="screen active">
  <div class="title-badge">A Teaching Game for Intersectionality</div>
  <h1 class="game-title">ACC<span>E</span>SS</h1>
  <p class="subtitle">Who gets in. Who gets left out. Why it's never one thing.</p>
  <p class="crenshaw-credit">Based on the framework of Dr. Kimberl√© Crenshaw</p>
  <div class="flex gap-12">
    <button class="big-btn" onclick="showScreen('rules-screen')">LEARN THE RULES</button>
    <button class="big-btn" style="background:transparent;border:2px solid var(--white);color:var(--white);" onclick="showScreen('setup-screen')">QUICK START</button>
  </div>
</div>

<!-- ============================
     RULES SCREEN
============================= -->
<div id="rules-screen" class="screen">
  <div style="padding:32px 40px; border-bottom:1px solid #1a1a1a; display:flex; align-items:center; gap:20px;">
    <span class="logo" style="font-family:'Unbounded',sans-serif;font-weight:900;font-size:20px;">ACC<span style="color:var(--red)">E</span>SS</span>
    <button class="action-btn btn-secondary" onclick="showScreen('title-screen')">‚Üê BACK</button>
    <button class="action-btn btn-primary" onclick="showScreen('setup-screen')" style="margin-left:auto">PLAY NOW ‚Üí</button>
  </div>
  <div style="max-width:800px;margin:0 auto;padding:60px 40px;display:flex;flex-direction:column;gap:40px;">

    <div>
      <h2 class="rules-title">How ACCESS Works</h2>
      <p style="font-size:13px;color:var(--light-gray);line-height:1.8;margin-top:16px;">ACCESS is a roleplaying strategy game where 2‚Äì6 players build characters with intersecting identities, then navigate real-world Scenarios that grant or restrict access to resources. Inspired by Kimberl√© Crenshaw's theory of intersectionality, the game reveals how overlapping identities create unique ‚Äî and often compounding ‚Äî experiences of privilege and marginalization.</p>
    </div>

    <div class="rule-block">
      <h3>Core Concept</h3>
      <p>Crenshaw showed that identities like race, gender, class, and disability don't operate independently ‚Äî they overlap and interact. A Black woman doesn't just experience racism + sexism as separate forces; she faces a distinct, combined form of discrimination that can't be understood by examining either alone. In ACCESS, your intersecting identities determine what doors open and which stay closed.</p>
    </div>

    <div class="rule-block">
      <h3>Game Structure ‚Äî Each Round (~10 min)</h3>
      <ul>
        <li><strong>Phase 1 ‚Äî Read the Scenario (1 min):</strong> A life situation is revealed: a job interview, a hospital visit, a housing application, a police encounter, etc.</li>
        <li><strong>Phase 2 ‚Äî Strategy Discussion (3 min):</strong> Players discuss how their identities might affect their outcomes. What advantages or barriers do you anticipate? Why?</li>
        <li><strong>Phase 3 ‚Äî Choose Your Approach (1 min):</strong> Each player selects a strategy card for how to navigate the scenario.</li>
        <li><strong>Phase 4 ‚Äî Reveal Outcomes (3 min):</strong> Access is granted or denied based on intersecting identities. Players narrate their character's experience.</li>
        <li><strong>Phase 5 ‚Äî Reflection (2 min):</strong> Instructor-guided debrief connects outcomes to Crenshaw's framework and real-world data.</li>
      </ul>
    </div>

    <div class="rule-block">
      <h3>Winning ‚Äî But It's Complicated</h3>
      <p>Players track an Access Score. But the goal isn't to "win" via privilege ‚Äî the game tracks <em>narrative richness</em>: how compellingly you articulate your character's experience. Players with more marginalized identities have more systemic barriers, but those barriers generate richer, more complex stories. The Reflection Phase often reframes who "won."</p>
    </div>

    <div class="rule-block">
      <h3>Identity Dimensions</h3>
      <ul>
        <li><strong>Race/Ethnicity</strong> ‚Äî central to Crenshaw's original analysis of Black women in the workplace</li>
        <li><strong>Gender</strong> ‚Äî including trans and non-binary identities, which face compounding barriers</li>
        <li><strong>Class</strong> ‚Äî socioeconomic position shapes access to nearly every resource</li>
        <li><strong>Disability Status</strong> ‚Äî often invisible in mainstream frameworks, highlighted by Crenshaw</li>
        <li><strong>Sexuality</strong> ‚Äî intersects with all other dimensions to create unique vulnerabilities</li>
      </ul>
    </div>

    <div style="background:#0d0d0d;border:1px solid var(--amber);padding:24px;">
      <div class="instructor-chip">INSTRUCTOR NOTE</div>
      <p style="font-size:12px;line-height:1.8;color:var(--light-gray);">Before starting, briefly introduce Crenshaw's 1989 paper "Demarginalizing the Intersection of Race and Sex." Remind students that character identities in this game are roles to inhabit thoughtfully ‚Äî not performances. Students should feel free to choose identities different from their own, and should approach others' experiences with curiosity and care. After each round, anchor the debrief to the assigned readings.</p>
    </div>

    <div style="text-align:center;">
      <button class="big-btn" onclick="showScreen('setup-screen')">START GAME ‚Üí</button>
    </div>
  </div>
</div>

<!-- ============================
     SETUP SCREEN
============================= -->
<div id="setup-screen" class="screen">
  <div class="screen-header">
    <span style="font-family:'Unbounded',sans-serif;font-weight:900;font-size:20px;">ACC<span style="color:var(--red)">E</span>SS</span>
    <span style="font-size:11px;letter-spacing:3px;text-transform:uppercase;color:var(--light-gray);">SETUP</span>
    <button class="action-btn btn-secondary" onclick="showScreen('title-screen')" style="margin-left:auto">‚Üê BACK</button>
  </div>
  <div class="setup-body">
    <div class="setup-panel" style="overflow-y:auto;">
      <div class="panel-label">01 ‚Äî Players</div>
      <div class="players-section" id="players-list">
        <!-- rendered by JS -->
      </div>
      <div style="display:flex;gap:12px;margin-bottom:32px;">
        <button class="action-btn btn-secondary" onclick="addPlayer()">+ ADD PLAYER</button>
        <button class="action-btn btn-secondary" onclick="removePlayer()">‚àí REMOVE</button>
      </div>

      <div class="panel-label">02 ‚Äî Rounds</div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:32px;">
        <button class="action-btn btn-secondary round-btn active-round" data-rounds="3" onclick="setRounds(3)">3 ROUNDS</button>
        <button class="action-btn btn-secondary round-btn" data-rounds="5" onclick="setRounds(5)">5 ROUNDS</button>
        <button class="action-btn btn-secondary round-btn" data-rounds="7" onclick="setRounds(7)">7 ROUNDS</button>
      </div>

      <div class="panel-label">03 ‚Äî Scenario Pack</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:32px;">
        <button class="action-btn btn-secondary pack-btn active-pack" data-pack="workplace">WORKPLACE</button>
        <button class="action-btn btn-secondary pack-btn" data-pack="healthcare">HEALTHCARE</button>
        <button class="action-btn btn-secondary pack-btn" data-pack="housing">HOUSING & LEGAL</button>
        <button class="action-btn btn-secondary pack-btn" data-pack="education">EDUCATION</button>
      </div>

      <button class="action-btn btn-primary" onclick="startGame()" style="width:100%">START GAME ‚Üí</button>
    </div>

    <div class="setup-panel" style="overflow-y:auto;">
      <div class="panel-label">04 ‚Äî Build Your Character</div>
      <p style="font-size:11px;color:var(--light-gray);margin-bottom:20px;line-height:1.7;">Select one identity from each dimension. Your intersecting identities will determine how scenarios unfold.</p>
      
      <div id="current-player-label" style="font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;color:var(--amber);margin-bottom:16px;letter-spacing:1px;">PLAYER 1</div>

      <div id="identity-builder">
        <!-- rendered by JS -->
      </div>

      <div class="character-preview" id="character-preview">
        <div class="char-name" id="preview-name">‚Äì</div>
        <div class="char-tags" id="preview-tags"></div>
        <div style="font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--light-gray);margin-bottom:6px;">STARTING ACCESS SCORE</div>
        <div style="display:flex;align-items:baseline;gap:10px;">
          <div class="access-score-value" id="preview-score">‚Äì</div>
          <div style="font-size:11px;color:var(--light-gray);">/ 100</div>
        </div>
        <div style="font-size:10px;color:#444;margin-top:8px;font-style:italic;" id="preview-note"></div>
      </div>

      <div style="display:flex;gap:12px;margin-top:16px;">
        <button class="action-btn btn-secondary" onclick="prevPlayerSetup()">‚Üê PREV</button>
        <button class="action-btn btn-confirm" onclick="nextPlayerSetup()" style="flex:1">NEXT PLAYER ‚Üí</button>
      </div>
    </div>
  </div>
</div>

<!-- ============================
     GAME SCREEN
============================= -->
<div id="game-screen" class="screen">
  <div class="screen-header">
    <span style="font-family:'Unbounded',sans-serif;font-weight:900;font-size:20px;">ACC<span style="color:var(--red)">E</span>SS</span>
    <div class="phase-steps" id="phase-steps">
      <div class="phase-step active" id="ps-read">READ</div>
      <div class="phase-step" id="ps-discuss">DISCUSS</div>
      <div class="phase-step" id="ps-choose">CHOOSE</div>
      <div class="phase-step" id="ps-reveal">REVEAL</div>
      <div class="phase-step" id="ps-reflect">REFLECT</div>
    </div>
    <div class="round-indicator" id="round-indicator">ROUND 1 / 3</div>
    <button class="action-btn btn-secondary" onclick="showScreen('title-screen')" style="font-size:10px;padding:8px 14px;clip-path:none;">QUIT</button>
  </div>
  <div class="timer-bar"><div class="timer-fill" id="timer-fill" style="width:100%"></div></div>

  <div class="game-layout">
    <!-- Left sidebar: Players -->
    <div class="sidebar">
      <div class="sidebar-title">Players</div>
      <div id="player-cards-sidebar"></div>

      <div class="sidebar-title" style="margin-top:24px;">Crenshaw's Lens</div>
      <div style="font-size:11px;line-height:1.8;color:var(--light-gray);font-style:italic;border-left:2px solid var(--red);padding-left:12px;" id="crenshaw-quote"></div>
    </div>

    <!-- Center: Scenario -->
    <div class="game-center">
      <div id="phase-read">
        <div class="scenario-card" id="scenario-card"></div>
      </div>

      <div id="phase-discuss" class="hidden">
        <div class="discussion-box" id="discussion-box"></div>
      </div>

      <div id="phase-choose" class="hidden">
        <div style="font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--light-gray);margin-bottom:16px;">CHOOSE YOUR APPROACH</div>
        <div class="access-options" id="access-options"></div>
      </div>

      <div id="phase-reveal" class="hidden">
        <div class="outcome-display" id="outcome-display"></div>
      </div>

      <div id="phase-reflect" class="hidden">
        <div class="reflection-box" id="reflection-box"></div>
      </div>

      <div style="display:flex;gap:12px;margin-top:auto;">
        <button class="action-btn btn-secondary hidden" id="btn-prev-phase" onclick="prevPhase()">‚Üê BACK</button>
        <button class="action-btn btn-primary" id="btn-next-phase" onclick="nextPhase()">NEXT ‚Üí</button>
      </div>
    </div>

    <!-- Right sidebar: Resources -->
    <div class="sidebar">
      <div class="sidebar-title">Resource Tracker</div>
      <div id="resource-tracker"></div>

      <div class="sidebar-title" style="margin-top:24px;">Scenario Context</div>
      <div id="scenario-context" style="font-size:11px;color:var(--light-gray);line-height:1.8;"></div>
    </div>
  </div>
</div>

<!-- ============================
     END SCREEN
============================= -->
<div id="end-screen" class="screen">
  <div style="font-family:'Unbounded',sans-serif;font-weight:900;font-size:48px;letter-spacing:-2px;color:var(--white);text-align:center;">GAME OVER</div>
  <div style="font-size:11px;letter-spacing:3px;text-transform:uppercase;color:var(--light-gray);margin-top:12px;text-align:center;">Final Access Scores & Reflection</div>
  <div class="final-scores" id="final-scores"></div>
  <div class="final-reflection">
    <div class="instructor-chip">DEBRIEF QUESTIONS</div>
    <ul class="reflection-questions" style="text-align:left;margin-top:16px;" id="final-reflection-questions"></ul>
  </div>
  <div style="display:flex;gap:16px;margin-top:40px;">
    <button class="big-btn" onclick="restartGame()">PLAY AGAIN</button>
    <button class="big-btn" style="background:transparent;border:2px solid var(--white);color:var(--white);" onclick="showScreen('title-screen')">MAIN MENU</button>
  </div>
</div>

<script>
// =========================================
// DATA
// =========================================

const IDENTITIES = {
  race: {
    label: "Race / Ethnicity",
    options: [
      { id: "white", name: "White", accessMod: 20, note: "Dominant racial group in most U.S. institutions" },
      { id: "black", name: "Black", accessMod: -15, note: "Crenshaw's original analysis centered on Black women's compounded marginalization" },
      { id: "hispanic", name: "Hispanic/Latino", accessMod: -8, note: "Faces racialized barriers in employment and housing" },
      { id: "asian", name: "Asian / Asian American", accessMod: -3, note: "Model minority myth can obscure real barriers; varies by ethnicity" },
      { id: "indigenous", name: "Indigenous", accessMod: -18, note: "Faces severe structural disadvantages across nearly all sectors" },
      { id: "multiracial", name: "Multiracial", accessMod: -5, note: "Experiences context-dependent discrimination and identity erasure" }
    ]
  },
  gender: {
    label: "Gender",
    options: [
      { id: "cis-man", name: "Cis Man", accessMod: 15, note: "Male privilege operates across most institutional contexts" },
      { id: "cis-woman", name: "Cis Woman", accessMod: -8, note: "Faces gendered wage gaps, harassment, and barriers in male-dominated fields" },
      { id: "trans-woman", name: "Trans Woman", accessMod: -20, note: "Faces compounded gender and trans-specific discrimination, violence risk" },
      { id: "trans-man", name: "Trans Man", accessMod: -10, note: "May gain some male privilege but faces trans-specific barriers" },
      { id: "nonbinary", name: "Non-Binary", accessMod: -14, note: "Institutional systems rarely accommodate non-binary existence" }
    ]
  },
  class: {
    label: "Socioeconomic Class",
    options: [
      { id: "upper", name: "Upper Class", accessMod: 25, note: "Wealth provides access to legal, medical, and social resources" },
      { id: "middle", name: "Middle Class", accessMod: 8, note: "Stable access but vulnerable to systemic shocks" },
      { id: "working", name: "Working Class", accessMod: -8, note: "Limited resources, time constraints reduce ability to navigate systems" },
      { id: "poor", name: "Living in Poverty", accessMod: -20, note: "Poverty severely restricts access; criminalized in many systems" }
    ]
  },
  disability: {
    label: "Disability Status",
    options: [
      { id: "no-disability", name: "No Disability", accessMod: 10, note: "Abled privilege is often invisible until barriers appear" },
      { id: "physical", name: "Physical Disability", accessMod: -12, note: "Physical environments and systems often exclude disabled people" },
      { id: "mental-health", name: "Mental Health Condition", accessMod: -10, note: "Stigma affects employment, housing, and medical treatment" },
      { id: "chronic-illness", name: "Chronic Illness", accessMod: -8, note: "Often invisible; faces medical gaslighting and system barriers" }
    ]
  },
  sexuality: {
    label: "Sexuality",
    options: [
      { id: "straight", name: "Straight / Heterosexual", accessMod: 8, note: "Heteronormative institutions default to straight experiences" },
      { id: "gay-lesbian", name: "Gay / Lesbian", accessMod: -10, note: "Faces discrimination in employment, housing, and healthcare" },
      { id: "bisexual", name: "Bisexual", accessMod: -8, note: "Bi-erasure creates unique barriers within and outside LGBTQ+ spaces" },
      { id: "queer", name: "Queer", accessMod: -10, note: "Non-normative sexual identities face institutional hostility" }
    ]
  }
};

const SCENARIOS = {
  workplace: [
    {
      id: "job-interview",
      title: "The Job Interview",
      desc: "You're interviewing for a management position at a mid-size firm. The interview panel is all white men. Your qualifications exceed the job description ‚Äî but the 'culture fit' question comes up repeatedly. Research shows identical resumes receive fewer callbacks when the name 'sounds' Black or female.",
      crenshawQuote: "\"[Black women] experience neither simple racism nor simple sexism, but a complex of racism and sexism that is often greater than the sum of its parts.\" ‚Äî Kimberl√© Crenshaw",
      context: "Studies: Audit studies show callback rates drop 30% for Black-sounding names. Women in male-dominated fields face 'role congruity' bias. These effects compound ‚Äî Black women face discrimination as neither 'generic Black' nor 'generic woman.'",
      discussionPrompt: "Before choosing your approach: How do you think each player's intersecting identities will affect the interviewer's perception? What biases might activate ‚Äî and how might they compound?",
      approaches: [
        { id: "direct", name: "Assert Qualifications", icon: "üìã", desc: "Directly address your credentials and redirect every question to your professional track record.", modifiers: {race: {black:-5,hispanic:-3,white:5}, gender: {'cis-woman':-4,'trans-woman':-8,'cis-man':3}, class:{poor:-3,upper:5}} },
        { id: "network", name: "Leverage Connections", icon: "ü§ù", desc: "Name-drop a mutual connection or reference someone inside the organization.", modifiers: {class:{upper:10,middle:3,working:-5,poor:-8}} },
        { id: "conform", name: "Code-Switch", icon: "üé≠", desc: "Minimize markers of your identity ‚Äî adjust speech, presentation, affect ‚Äî to fit dominant expectations.", modifiers: {race:{black:-3,white:3}, gender:{'trans-woman':-8,'nonbinary':-6}} },
        { id: "authentic", name: "Stay Authentic", icon: "üåü", desc: "Present your full identity without code-switching ‚Äî advocate for yourself as you are.", modifiers: {race:{black:-8,indigenous:-8,white:2}, gender:{'cis-woman':-5,'trans-woman':-12,'nonbinary':-10}} }
      ],
      resources: ["üíº Employment", "üí∞ Income", "üè• Healthcare", "ü§ù Professional Network"],
      reflection: [
        "Who was most disadvantaged in this scenario ‚Äî and was it for one reason or multiple intersecting ones?",
        "How did Code-Switching affect outcomes differently across identities? What does this reveal about whose 'normal' is centered?",
        "Crenshaw argues that anti-discrimination law fails Black women because it treats race and sex as separate. How did this scenario show that they can't be separated?",
        "What would this workplace need to change structurally to produce equitable outcomes?"
      ]
    },
    {
      id: "workplace-harassment",
      title: "Workplace Harassment",
      desc: "A colleague makes repeated comments about your appearance and shares an offensive joke in a Slack channel. You've documented three incidents. HR is run by a close friend of the colleague. Research shows complaints are more likely to be dismissed for workers with marginalized identities.",
      crenshawQuote: "\"The primary beneficiaries of policies against sexual harassment are those whose experiences are centered in the policies' design.\" ‚Äî Kimberl√© Crenshaw",
      context: "EEOC data: Black women are more likely to face sexual harassment and less likely to see complaints resolved. Trans workers face significantly higher rates of hostile work environment claims dismissed. Low-income workers fear retaliation more than higher-wage earners.",
      discussionPrompt: "Consider: Who in the room would likely be taken most seriously if they filed a complaint? Who has the most to lose by reporting? How does intersectionality explain these differences?",
      approaches: [
        { id: "formal", name: "File Formal Complaint", icon: "üìù", desc: "Submit documented complaint through official HR channels.", modifiers: {race:{black:-8,white:5,hispanic:-5}, gender:{'trans-woman':-12,'cis-woman':-5,'cis-man':3}, class:{poor:-5,upper:5}} },
        { id: "escalate", name: "Escalate to Leadership", icon: "‚¨ÜÔ∏è", desc: "Go above HR directly to senior leadership.", modifiers: {class:{upper:8,middle:2,working:-4,poor:-8}} },
        { id: "coalition", name: "Build Coalition", icon: "‚úä", desc: "Organize with other affected colleagues to file a joint complaint.", modifiers: {race:{black:3,hispanic:3,indigenous:4}, disability:{'mental-health':-4}} },
        { id: "document", name: "Document & Wait", icon: "üìÅ", desc: "Continue building documentation while monitoring the situation.", modifiers: {race:{white:2}, class:{working:-3,poor:-5}} }
      ],
      resources: ["‚öñÔ∏è Legal Protection", "üíº Employment", "üß† Mental Health", "ü§ù Professional Network"],
      reflection: [
        "How did the intersectionality of race and gender affect whose complaint would be most credible?",
        "What does it mean that 'coalition building' was one of the more effective strategies for marginalized workers?",
        "Crenshaw coined 'intersectionality' while analyzing the case DeGraffenreid v. General Motors ‚Äî where Black women's claims were dismissed because Black men weren't fired and white women weren't harassed. How does this connect to today's scenario?",
        "What structural changes would make harassment reporting systems more equitable?"
      ]
    },
    {
      id: "promotion-gap",
      title: "The Promotion Gap",
      desc: "You've been passed over for promotion twice. A colleague with fewer years' experience ‚Äî and lower performance reviews ‚Äî was promoted instead. When you ask your manager, they cite 'leadership presence' and 'executive readiness.' Neither term has been defined. You have the same qualifications.",
      crenshawQuote: "\"Intersectionality is a lens through which you can see where power comes and collides, where it interlocks and intersects.\" ‚Äî Kimberl√© Crenshaw",
      context: "McKinsey/LeanIn data: Black women are the most underrepresented group in corporate management. For every 100 men promoted to manager, only 58 Black women are. Disability status further reduces promotion likelihood. 'Leadership presence' as a criterion often encodes racial and gender bias.",
      discussionPrompt: "'Leadership presence' ‚Äî who gets described this way and who doesn't? Before revealing outcomes, predict which characters will be told they lack it and which won't.",
      approaches: [
        { id: "ask", name: "Request Specific Criteria", icon: "üîç", desc: "Ask your manager to define 'leadership presence' in measurable terms.", modifiers: {gender:{'cis-man':5,'cis-woman':-5,'trans-woman':-8,'nonbinary':-6}, race:{white:5,black:-6}} },
        { id: "mentor", name: "Seek Executive Sponsor", icon: "üåü", desc: "Find a senior leader who will advocate for you with leadership.", modifiers: {class:{upper:8,middle:2,working:-4,poor:-8}} },
        { id: "lateral", name: "Lateral Move", icon: "‚ÜóÔ∏è", desc: "Transfer to another team where your skills may be better valued.", modifiers: {disability:{'physical':-5,'no-disability':3}} },
        { id: "external", name: "Apply Externally", icon: "üö™", desc: "Start an external job search to get the title and pay you deserve elsewhere.", modifiers: {race:{black:-3,white:3}, gender:{'cis-woman':-3,'trans-woman':-8}} }
      ],
      resources: ["üíº Employment", "üí∞ Income", "ü§ù Professional Network", "üìà Career Growth"],
      reflection: [
        "How is 'leadership presence' an example of what Crenshaw calls structural discrimination ‚Äî bias embedded in neutral-seeming criteria?",
        "Who had the most options in this scenario? What identity features gave them those options?",
        "Research shows Black women are often seen as 'too aggressive' when they assert themselves but 'not leadership material' when they don't. How does this double-bind appear in our game?",
        "What would equitable promotion criteria look like?"
      ]
    }
  ],
  healthcare: [
    {
      id: "pain-ignored",
      title: "Pain Not Believed",
      desc: "You go to the ER with severe pain. You've been waiting 4 hours. When you finally see a doctor, they seem skeptical of your pain level and suggest it may be 'anxiety.' Research shows pain reports from certain patients are systematically under-treated ‚Äî a pattern with documented racial and gender dimensions.",
      crenshawQuote: "\"The convergence of sexism and racism in the lives of Black women contributes to a marginalization that is more profound than the sum of both.\" ‚Äî Kimberl√© Crenshaw",
      context: "Research: A 2016 study found many medical students held false beliefs that Black patients feel less pain. Women's pain is dismissed as 'emotional' at significantly higher rates. Black women with lupus ‚Äî predominantly a disease of Black women ‚Äî experience 3‚Äì5 year delays in diagnosis. Trans patients face open hostility in ERs.",
      discussionPrompt: "The doctor has formed an impression before you've spoken much. How does your character's identity shape that impression? How might multiple identities interact to make pain dismissal more or less likely?",
      approaches: [
        { id: "advocate", name: "Firmly Advocate", icon: "üó£Ô∏è", desc: "Clearly and repeatedly state your pain level and request specific tests.", modifiers: {gender:{'cis-man':8,'cis-woman':-5,'trans-woman':-10,'nonbinary':-8}, race:{black:-8,white:5}} },
        { id: "documentation", name: "Reference Documentation", icon: "üìã", desc: "Present prior medical records and written pain documentation.", modifiers: {class:{upper:6,middle:3,working:-2,poor:-6}} },
        { id: "companion", name: "Request a Companion", icon: "üë•", desc: "Ask to have a support person accompany you into the exam.", modifiers: {disability:{'mental-health':-5,'physical':-3,'no-disability':2}} },
        { id: "second-opinion", name: "Request Another Doctor", icon: "üîÑ", desc: "Ask to be seen by a different physician.", modifiers: {race:{white:5,black:-6,hispanic:-4}, class:{poor:-8,upper:5}} }
      ],
      resources: ["üè• Healthcare", "üß† Mental Health", "üí∞ Income", "‚öñÔ∏è Legal Protection"],
      reflection: [
        "Crenshaw argues that single-axis frameworks miss the unique position of Black women. How did this appear in the healthcare scenario?",
        "What surprised you about how class interacted with race and gender in accessing medical care?",
        "How does the concept of medical mistrust (a historically earned distrust of the medical system) connect to this scenario?",
        "What would patient-centered, intersectionally aware healthcare look like?"
      ]
    }
  ],
  housing: [
    {
      id: "housing-application",
      title: "The Rental Application",
      desc: "You've applied for an apartment in a desirable neighborhood. Your application is strong ‚Äî good income, references, no prior evictions. The landlord has met with you once. You receive a vague rejection citing 'concerns about fit.' The same unit was later listed again. Fair housing law prohibits discrimination, but proving it is nearly impossible.",
      crenshawQuote: "\"Intersectionality helps us understand how structural forces shape individual lives in ways that no single lens can capture.\" ‚Äî Kimberl√© Crenshaw",
      context: "Audit studies: Landlords reject applications from Black and Latino applicants at significantly higher rates with identical qualifications. LGBTQ+ applicants, especially trans individuals, face discrimination in housing. Disabled applicants face denial despite legal protections. Low-income applicants face informal credit screening that disadvantages communities of color.",
      discussionPrompt: "The landlord can legally require income and credit information. What other 'signals' might they be reading ‚Äî consciously or not? How do your identities affect what signals you're sending?",
      approaches: [
        { id: "appeal", name: "Appeal the Decision", icon: "üì¨", desc: "Write a formal appeal emphasizing your qualifications and requesting a reason.", modifiers: {class:{upper:5,middle:2,working:-2,poor:-5}, race:{black:-6,white:4}} },
        { id: "legal", name: "Contact Fair Housing", icon: "‚öñÔ∏è", desc: "File a complaint with a fair housing organization or legal aid clinic.", modifiers: {class:{poor:-5,working:-3,middle:3,upper:6}, disability:{'physical':-4}} },
        { id: "audit", name: "Send a Proxy", icon: "üîç", desc: "Have a friend with different demographics apply to test for discrimination.", modifiers: {race:{black:5,hispanic:5,indigenous:5}} },
        { id: "negotiate", name: "Offer Extra Assurances", icon: "üíº", desc: "Offer additional deposit or first/last month rent to allay stated concerns.", modifiers: {class:{poor:-10,working:-5,middle:2,upper:8}} }
      ],
      resources: ["üè† Housing", "‚öñÔ∏è Legal Protection", "üí∞ Income", "üåê Community"],
      reflection: [
        "Housing segregation has been described as the 'structural backbone' of American inequality. How do discriminatory housing practices interact with wealth, health, and education gaps?",
        "Which approaches were available to more privileged players but not others? What does that reveal?",
        "Crenshaw's work often centers what happens when structural discrimination is invisible. How is housing discrimination designed to be invisible?",
        "What policies or practices might reduce intersectional housing discrimination?"
      ]
    }
  ],
  education: [
    {
      id: "financial-aid",
      title: "The Financial Aid Gap",
      desc: "You're applying for a merit scholarship at your university. Your GPA and extracurriculars qualify you ‚Äî but the process requires letters of recommendation from faculty you've never spoken to, a personal essay, and a department interview. Students with more social capital navigate this process more easily.",
      crenshawQuote: "\"Not all Black women experience racism and sexism the same way. It depends on all the other identities that come into play.\" ‚Äî Kimberl√© Crenshaw",
      context: "Research: First-generation college students, students of color, and students with disabilities are significantly less likely to win institutional scholarships despite equal qualifications. Faculty mentorship is not equally distributed ‚Äî research shows faculty are more likely to mentor students who remind them of themselves. Working-class students often can't take unpaid internships required to be 'competitive.'",
      discussionPrompt: "The scholarship requires 'demonstrated leadership and character.' Who gets to define leadership and character? How might bias operate in a department interview?",
      approaches: [
        { id: "professors", name: "Cultivate Relationships", icon: "üéì", desc: "Invest in office hours and building relationships with faculty who can write letters.", modifiers: {race:{white:6,black:-5,hispanic:-3}, gender:{'cis-man':3,'cis-woman':-2,'trans-woman':-8,'nonbinary':-6}} },
        { id: "advising", name: "Use Academic Advising", icon: "üìö", desc: "Get institutional support from advising resources to navigate the process.", modifiers: {class:{poor:3,working:3,middle:1}, disability:{'physical':2,'mental-health':1}} },
        { id: "outside", name: "Apply for Outside Aid", icon: "üåê", desc: "Focus energy on identity-specific external scholarships.", modifiers: {race:{black:5,hispanic:5,indigenous:6}, sexuality:{'gay-lesbian':4,'queer':4}} },
        { id: "coalition", name: "Organize with Peers", icon: "‚úä", desc: "Work with other students to advocate for more transparent and equitable scholarship criteria.", modifiers: {race:{black:3,hispanic:3,indigenous:4}, class:{poor:2,working:2}} }
      ],
      resources: ["üéì Education Access", "üí∞ Income", "üìà Career Growth", "ü§ù Professional Network"],
      reflection: [
        "How does 'merit' function in this scenario? Who has had advantages in building the credentials that count as merit?",
        "First-generation students often lack the 'hidden curriculum' of how to navigate institutions. How does this connect to class intersecting with race?",
        "Crenshaw talks about how anti-discrimination law focuses on intentional bias. What forms of unintentional or structural bias appeared in this scenario?",
        "What would genuinely equitable scholarship selection look like?"
      ]
    }
  ]
};

const CRENSHAW_QUOTES = [
  "\"Intersectionality is not just about identities, but about the institutions that use identity to exclude and privilege.\" ‚Äî Kimberl√© Crenshaw",
  "\"If we aren't intersectional, some of us, the most vulnerable, are going to fall through the cracks.\" ‚Äî Kimberl√© Crenshaw",
  "\"All inequality is not equal.\" ‚Äî Kimberl√© Crenshaw",
  "\"When people say we need to be talking about class, not race ‚Äî that's a false choice. The question is: what's the relationship between race and class?\" ‚Äî Kimberl√© Crenshaw"
];

// =========================================
// GAME STATE
// =========================================
let state = {
  numPlayers: 2,
  players: [
    { name: "Player 1", identities: {}, score: 50 },
    { name: "Player 2", identities: {}, score: 50 }
  ],
  totalRounds: 3,
  currentRound: 0,
  currentPhase: 0, // 0=read,1=discuss,2=choose,3=reveal,4=reflect
  scenarioPack: 'workplace',
  scenarios: [],
  currentScenario: null,
  playerChoices: {},
  setupPlayerIndex: 0,
  timerInterval: null,
  timerSeconds: 0,
  resources: {
    "üíº Employment": 50,
    "üí∞ Income": 50,
    "üè• Healthcare": 50,
    "üè† Housing": 50,
    "üéì Education Access": 50,
    "‚öñÔ∏è Legal Protection": 50,
    "üß† Mental Health": 50,
    "ü§ù Professional Network": 50,
    "üåê Community": 50,
    "üìà Career Growth": 50
  }
};

const PHASES = ['read', 'discuss', 'choose', 'reveal', 'reflect'];
const PHASE_TIMES = [60, 180, 60, 180, 120]; // seconds

// =========================================
// UTILITY
// =========================================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function calcBaseScore(identities) {
  let score = 50;
  for (const [dim, id] of Object.entries(identities)) {
    const opt = IDENTITIES[dim]?.options.find(o => o.id === id);
    if (opt) score += opt.accessMod;
  }
  return Math.max(5, Math.min(100, score));
}

function getPlayer(idx) { return state.players[idx]; }

// =========================================
// SETUP
// =========================================
function renderSetup() {
  // Render player list
  const pl = document.getElementById('players-list');
  pl.innerHTML = '';
  state.players.forEach((p, i) => {
    pl.innerHTML += `<div class="player-row">
      <div class="player-num">${i+1}</div>
      <input class="player-name-input" placeholder="Player ${i+1} name" value="${p.name}" oninput="state.players[${i}].name=this.value;renderCharPreview()">
      <span style="font-size:9px;letter-spacing:2px;color:${state.players[i].identities && Object.keys(state.players[i].identities).length>=5?'var(--green)':'var(--amber)'}">${Object.keys(state.players[i].identities||{}).length}/5</span>
    </div>`;
  });

  // Render identity builder for current setup player
  const idx = state.setupPlayerIndex;
  document.getElementById('current-player-label').textContent = `BUILDING: ${state.players[idx].name.toUpperCase()}`;

  const ib = document.getElementById('identity-builder');
  ib.innerHTML = '';
  for (const [dim, data] of Object.entries(IDENTITIES)) {
    let html = `<div style="margin-bottom:20px;">
      <div style="font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--light-gray);margin-bottom:10px;">${data.label}</div>
      <div style="display:flex;flex-direction:column;gap:6px;">`;
    data.options.forEach(opt => {
      const selected = state.players[idx].identities[dim] === opt.id;
      html += `<div class="identity-card ${selected?'selected':''}" onclick="selectIdentity('${dim}','${opt.id}')">
        <div class="identity-name">${opt.name}</div>
        <div style="font-size:10px;color:var(--light-gray);margin-top:4px;line-height:1.5;">${opt.note}</div>
        <div class="privilege-bar-container"><div class="privilege-bar" style="width:${Math.max(5,50+opt.accessMod)}%"></div></div>
      </div>`;
    });
    html += `</div></div>`;
    ib.innerHTML += html;
  }

  renderCharPreview();
}

function selectIdentity(dim, id) {
  const idx = state.setupPlayerIndex;
  state.players[idx].identities[dim] = id;
  renderSetup();
}

function renderCharPreview() {
  const idx = state.setupPlayerIndex;
  const p = state.players[idx];
  const score = calcBaseScore(p.identities);
  document.getElementById('preview-name').textContent = p.name || `Player ${idx+1}`;
  const tagsEl = document.getElementById('preview-tags');
  tagsEl.innerHTML = '';
  Object.entries(p.identities).forEach(([dim, id]) => {
    const opt = IDENTITIES[dim]?.options.find(o => o.id === id);
    if (opt) tagsEl.innerHTML += `<span class="char-tag">${opt.name}</span>`;
  });
  const numId = Object.keys(p.identities).length;
  document.getElementById('preview-score').textContent = numId < 5 ? '‚Äî' : score;
  document.getElementById('preview-score').style.color = score > 60 ? 'var(--green)' : score > 35 ? 'var(--amber)' : 'var(--red)';
  document.getElementById('preview-note').textContent = numId < 5
    ? `Select all 5 dimensions (${5-numId} remaining)` 
    : score > 65 ? 'High structural access ‚Äî you\'ll face fewer systemic barriers'
    : score < 35 ? 'Multiple intersecting marginalized identities ‚Äî expect compounded barriers'
    : 'Mixed access ‚Äî you\'ll face some barriers that others don\'t';
}

function addPlayer() {
  if (state.players.length >= 6) return;
  state.players.push({ name: `Player ${state.players.length+1}`, identities: {}, score: 50 });
  renderSetup();
}

function removePlayer() {
  if (state.players.length <= 2) return;
  state.players.pop();
  if (state.setupPlayerIndex >= state.players.length) state.setupPlayerIndex = state.players.length - 1;
  renderSetup();
}

function setRounds(n) {
  state.totalRounds = n;
  document.querySelectorAll('.round-btn').forEach(b => {
    b.classList.toggle('active-round', parseInt(b.dataset.rounds)===n);
  });
}

function prevPlayerSetup() {
  if (state.setupPlayerIndex > 0) state.setupPlayerIndex--;
  renderSetup();
}

function nextPlayerSetup() {
  if (state.setupPlayerIndex < state.players.length - 1) {
    state.setupPlayerIndex++;
    renderSetup();
  } else {
    // finalize
    const incomplete = state.players.find(p => Object.keys(p.identities).length < 5);
    if (incomplete) {
      alert(`${incomplete.name} hasn't selected all 5 identity dimensions yet.`);
      return;
    }
    state.players.forEach(p => { p.score = calcBaseScore(p.identities); });
    startGame();
  }
}

document.querySelectorAll('.pack-btn').forEach(b => {
  b.addEventListener('click', () => {
    state.scenarioPack = b.dataset.pack;
    document.querySelectorAll('.pack-btn').forEach(pb => pb.classList.remove('active-pack'));
    b.classList.add('active-pack');
  });
});

// =========================================
// GAME START
// =========================================
function startGame() {
  // Validate
  const incomplete = state.players.find(p => Object.keys(p.identities).length < 5);
  if (incomplete) {
    alert(`${incomplete.name} hasn't selected all 5 identity dimensions. Please complete character setup.`);
    showScreen('setup-screen');
    state.setupPlayerIndex = state.players.indexOf(incomplete);
    renderSetup();
    return;
  }

  state.players.forEach(p => { p.score = calcBaseScore(p.identities); });

  // Pick scenarios
  const pack = SCENARIOS[state.scenarioPack] || SCENARIOS.workplace;
  state.scenarios = [];
  const available = [...pack];
  // also pull from other packs if needed
  const allScenarios = Object.values(SCENARIOS).flat();
  for (let i = 0; i < state.totalRounds; i++) {
    if (available.length > 0) {
      const idx = Math.floor(Math.random() * available.length);
      state.scenarios.push(available.splice(idx, 1)[0]);
    } else {
      const fallback = allScenarios[Math.floor(Math.random() * allScenarios.length)];
      state.scenarios.push(fallback);
    }
  }

  state.currentRound = 0;
  state.currentPhase = 0;
  state.playerChoices = {};

  showScreen('game-screen');
  loadRound();
}

// =========================================
// ROUND / PHASE
// =========================================
function loadRound() {
  state.currentScenario = state.scenarios[state.currentRound];
  state.currentPhase = 0;
  state.playerChoices = {};
  document.getElementById('round-indicator').textContent = `ROUND ${state.currentRound+1} / ${state.totalRounds}`;
  renderPhase();
}

function renderPhase() {
  const s = state.currentScenario;
  const phase = PHASES[state.currentPhase];

  // Update phase steps
  PHASES.forEach((p, i) => {
    const el = document.getElementById(`ps-${p}`);
    el.classList.remove('active', 'done');
    if (i < state.currentPhase) el.classList.add('done');
    if (i === state.currentPhase) el.classList.add('active');
  });

  // Hide/show phase panels
  document.querySelectorAll('[id^="phase-"]').forEach(el => el.classList.add('hidden'));
  document.getElementById(`phase-${phase}`).classList.remove('hidden');

  // Nav buttons
  const prevBtn = document.getElementById('btn-prev-phase');
  const nextBtn = document.getElementById('btn-next-phase');
  prevBtn.classList.toggle('hidden', state.currentPhase === 0);

  if (phase === 'reflect') {
    nextBtn.textContent = state.currentRound < state.totalRounds - 1 ? 'NEXT ROUND ‚Üí' : 'SEE RESULTS ‚Üí';
  } else {
    nextBtn.textContent = 'NEXT ‚Üí';
  }

  // Render sidebar
  renderPlayerSidebar();
  renderResourceTracker(s);
  document.getElementById('scenario-context').innerHTML = s.context.replace(/\. /g,'.<br><br>');
  document.getElementById('crenshaw-quote').textContent = CRENSHAW_QUOTES[state.currentRound % CRENSHAW_QUOTES.length];

  if (phase === 'read') renderReadPhase(s);
  if (phase === 'discuss') renderDiscussPhase(s);
  if (phase === 'choose') renderChoosePhase(s);
  if (phase === 'reveal') renderRevealPhase(s);
  if (phase === 'reflect') renderReflectPhase(s);

  startTimer(PHASE_TIMES[state.currentPhase]);
}

function renderReadPhase(s) {
  document.getElementById('scenario-card').innerHTML = `
    <div class="scenario-title">${s.title}</div>
    <div class="scenario-desc">${s.desc}</div>
    <div style="margin-top:16px;padding:12px;background:#111;border-left:3px solid var(--red);">
      <div style="font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--red);margin-bottom:8px;">CRENSHAW CONNECTION</div>
      <div style="font-size:11px;color:var(--light-gray);font-style:italic;">${s.crenshawQuote}</div>
    </div>
  `;
}

function renderDiscussPhase(s) {
  document.getElementById('phase-discuss').innerHTML = `
    <div class="discussion-prompt">
      <div class="discussion-prompt-label">Discussion Prompt (3 minutes)</div>
      <p>${s.discussionPrompt}</p>
    </div>
    <div style="background:#0d0d0d;border:1px solid #222;padding:24px;margin-top:16px;">
      <div style="font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--light-gray);margin-bottom:16px;">GUIDE QUESTIONS</div>
      <ul style="list-style:none;display:flex;flex-direction:column;gap:12px;">
        <li style="font-size:12px;color:var(--light-gray);border-left:2px solid var(--amber);padding-left:12px;">Which of your identities do you think will be most salient in this scenario ‚Äî and why that one rather than others?</li>
        <li style="font-size:12px;color:var(--light-gray);border-left:2px solid var(--amber);padding-left:12px;">Are there combinations of identities you think will create unique disadvantages ‚Äî not just the sum of separate disadvantages?</li>
        <li style="font-size:12px;color:var(--light-gray);border-left:2px solid var(--amber);padding-left:12px;">What systemic forces (laws, policies, norms, biases) are operating in this scenario?</li>
      </ul>
    </div>
  `;
}

function renderChoosePhase(s) {
  const el = document.getElementById('access-options');
  el.innerHTML = '';
  s.approaches.forEach(approach => {
    const anySelected = Object.keys(state.playerChoices).length > 0;
    el.innerHTML += `<div class="access-option ${anySelected && state.playerChoices[state.players[0].name]===approach.id?'selected-choice':''}" onclick="selectApproach('${approach.id}')">
      <div class="access-option-header">
        <span class="access-icon">${approach.icon}</span>
        <span class="access-option-name">${approach.name}</span>
      </div>
      <div class="access-option-desc">${approach.desc}</div>
      <div style="font-size:9px;letter-spacing:2px;text-transform:uppercase;color:#555;margin-bottom:6px;">IDENTITY MODIFIERS (examples)</div>
      <div class="access-modifiers">
        ${Object.entries(approach.modifiers||{}).slice(0,2).map(([dim,mods])=>
          Object.entries(mods).slice(0,2).map(([id,val])=>{
            const opt = IDENTITIES[dim]?.options.find(o=>o.id===id);
            return `<div class="modifier-row"><span class="modifier-label">${opt?.name||id}</span><span class="modifier-val ${val>0?'pos':val<0?'neg':'neu'}">${val>0?'+':''}${val}</span></div>`;
          }).join('')
        ).join('')}
      </div>
    </div>`;
  });
  // For simplicity: all players choose the same approach (game facilitator picks), or we track per player
}

function selectApproach(id) {
  state.players.forEach(p => { state.playerChoices[p.name] = id; });
  document.querySelectorAll('.access-option').forEach(el => el.classList.remove('selected-choice'));
  event.currentTarget.classList.add('selected-choice');
}

function renderRevealPhase(s) {
  const chosen = state.playerChoices[state.players[0].name] || s.approaches[0].id;
  const approach = s.approaches.find(a => a.id === chosen) || s.approaches[0];

  let html = `<div class="outcome-header">OUTCOME REVEAL ‚Äî APPROACH: ${approach.name}</div>`;
  html += `<div class="outcome-list">`;

  state.players.forEach(p => {
    // Calculate modifier
    let mod = 0;
    Object.entries(approach.modifiers || {}).forEach(([dim, mods]) => {
      const playerIdentity = p.identities[dim];
      if (playerIdentity && mods[playerIdentity] !== undefined) {
        mod += mods[playerIdentity];
      }
    });
    // Base identity mod
    const baseScore = calcBaseScore(p.identities);
    const outcome = baseScore + mod;
    const gained = outcome > 55;
    const blocked = outcome < 30;

    const delta = Math.round(mod + (baseScore - 50) * 0.3);
    p.score = Math.max(5, Math.min(100, p.score + delta * 0.4));

    const tagList = Object.entries(p.identities).map(([dim, id]) => {
      const opt = IDENTITIES[dim]?.options.find(o => o.id === id);
      return opt?.name || id;
    }).join(' √ó ');

    html += `<div class="outcome-item ${gained?'gained':blocked?'blocked':'lost'}">
      <span class="outcome-badge ${gained?'g':blocked?'b':'l'}">${gained?'GRANTED':blocked?'BLOCKED':'LIMITED'}</span>
      <div>
        <div class="outcome-text"><strong>${p.name}</strong> ‚Äî ${tagList}</div>
        <div class="outcome-why">${gained 
          ? `Your identity combination creates relatively fewer systemic barriers in this context. Access score: +${Math.abs(Math.round(delta))}`
          : blocked
          ? `Multiple intersecting marginalized identities create compounding barriers. The system was not designed with your position in mind. Access score: ${Math.round(delta)}`
          : `You face real barriers, though some identities partially mitigate others. Access score: ${Math.round(delta)}`
        }</div>
        <div style="margin-top:8px;height:3px;background:#222;"><div style="height:100%;width:${Math.max(5,Math.min(100,outcome))}%;background:${gained?'var(--green)':blocked?'#444':'var(--amber)'}"></div></div>
      </div>
    </div>`;
  });

  html += `</div>`;
  document.getElementById('outcome-display').innerHTML = html;
}

function renderReflectPhase(s) {
  let qHtml = s.reflection.map(q => `<li>${q}</li>`).join('');
  document.getElementById('phase-reflect').innerHTML = `
    <div class="reflection-box">
      <div class="instructor-chip">REFLECTION ‚Äî INSTRUCTOR LED</div>
      <div style="font-size:13px;color:var(--white);font-weight:700;margin-bottom:16px;">Connecting to Crenshaw's Framework</div>
      <ul class="reflection-questions">${qHtml}</ul>
      <div style="margin-top:24px;padding:16px;background:#0a0a0a;border-top:1px solid #1a1a1a;">
        <div style="font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--amber);margin-bottom:8px;">KEY CONCEPT FROM THIS ROUND</div>
        <div style="font-size:12px;color:var(--light-gray);font-style:italic;line-height:1.7;">${s.crenshawQuote}</div>
      </div>
    </div>
  `;
}

function renderPlayerSidebar() {
  const el = document.getElementById('player-cards-sidebar');
  el.innerHTML = '';
  state.players.forEach(p => {
    const score = Math.round(p.score);
    const cls = score > 60 ? 'positive' : score < 35 ? 'negative' : 'neutral';
    const tags = Object.entries(p.identities).map(([dim,id]) => {
      const opt = IDENTITIES[dim]?.options.find(o=>o.id===id);
      return opt?.name||id;
    });
    el.innerHTML += `<div class="player-card">
      <div class="player-card-name">${p.name}</div>
      <div class="player-tags-mini">${tags.map(t=>`<span class="tag-mini">${t}</span>`).join('')}</div>
      <div class="score-row">
        <span class="score-label">Access Score</span>
        <span class="score-val ${cls}">${score}</span>
      </div>
    </div>`;
  });
}

function renderResourceTracker(s) {
  const el = document.getElementById('resource-tracker');
  el.innerHTML = '';
  (s.resources || []).forEach(r => {
    const avgScore = state.players.reduce((sum,p) => sum + p.score, 0) / state.players.length;
    const status = avgScore > 60 ? 'have' : avgScore < 35 ? 'lack' : 'partial';
    const statusLabel = status === 'have' ? 'ACCESSIBLE' : status === 'lack' ? 'RESTRICTED' : 'PARTIAL';
    el.innerHTML += `<div class="resource-item">
      <span class="resource-icon">${r.split(' ')[0]}</span>
      <span class="resource-name">${r.split(' ').slice(1).join(' ')}</span>
      <span class="resource-status ${status}">${statusLabel}</span>
    </div>`;
  });
}

// =========================================
// NAVIGATION
// =========================================
function nextPhase() {
  if (state.currentPhase < PHASES.length - 1) {
    state.currentPhase++;
    renderPhase();
  } else {
    // End of round
    state.currentRound++;
    if (state.currentRound >= state.totalRounds) {
      showEndScreen();
    } else {
      loadRound();
    }
  }
}

function prevPhase() {
  if (state.currentPhase > 0) {
    state.currentPhase--;
    renderPhase();
  }
}

// =========================================
// TIMER
// =========================================
function startTimer(seconds) {
  clearInterval(state.timerInterval);
  state.timerSeconds = seconds;
  const fill = document.getElementById('timer-fill');
  fill.style.width = '100%';
  fill.style.background = 'var(--red)';

  state.timerInterval = setInterval(() => {
    state.timerSeconds--;
    const pct = (state.timerSeconds / seconds) * 100;
    fill.style.width = pct + '%';
    if (pct < 20) fill.style.background = '#d4820a';
  }, 1000);
}

// =========================================
// END SCREEN
// =========================================
function showEndScreen() {
  clearInterval(state.timerInterval);
  const sorted = [...state.players].sort((a,b) => b.score - a.score);
  const winner = sorted[0];

  const scoresEl = document.getElementById('final-scores');
  scoresEl.innerHTML = sorted.map(p => {
    const score = Math.round(p.score);
    const tags = Object.entries(p.identities).map(([dim,id]) => {
      const opt = IDENTITIES[dim]?.options.find(o=>o.id===id);
      return opt?.name||id;
    });
    const cls = score > 60 ? 'var(--green)' : score < 35 ? 'var(--red)' : 'var(--amber)';
    return `<div class="final-card ${p===winner?'winner':''}">
      ${p===winner?'<div style="font-size:9px;letter-spacing:3px;color:var(--amber);margin-bottom:8px;">HIGHEST ACCESS</div>':''}
      <div class="final-player-name">${p.name}</div>
      <div style="display:flex;flex-wrap:wrap;gap:4px;justify-content:center;margin-bottom:12px;">${tags.map(t=>`<span style="font-size:8px;padding:2px 6px;background:#1a1a1a;color:var(--light-gray);">${t}</span>`).join('')}</div>
      <div class="final-score-big" style="color:${cls}">${score}</div>
      <div style="font-size:9px;letter-spacing:2px;text-transform:uppercase;color:#555;">Access Score</div>
    </div>`;
  }).join('');

  document.getElementById('final-reflection-questions').innerHTML = `
    <li>The player with the highest Access Score "won" ‚Äî but does winning reflect something we should want? What does this reveal about privilege?</li>
    <li>Who experienced the most complex, layered set of barriers? How did intersecting identities create challenges no single identity would predict?</li>
    <li>Crenshaw argues that intersectionality is not about adding up disadvantages, but understanding their unique interaction. Where did you see this in the game?</li>
    <li>What single change ‚Äî to law, policy, or institutional culture ‚Äî would most benefit the most-marginalized player in the group?</li>
    <li>How might you apply an intersectional lens to your own life ‚Äî to institutions you're part of, or systems you design?</li>
  `;

  showScreen('end-screen');
}

function restartGame() {
  state.currentRound = 0;
  state.players.forEach(p => { p.score = calcBaseScore(p.identities); });
  state.playerChoices = {};
  showScreen('setup-screen');
  state.setupPlayerIndex = 0;
  renderSetup();
}

// =========================================
// INIT
// =========================================
document.addEventListener('DOMContentLoaded', () => {
  // Add style for active buttons
  const style = document.createElement('style');
  style.textContent = `
    .active-round, .active-pack { background: var(--amber) !important; color: var(--black) !important; border-color: var(--amber) !important; }
  `;
  document.head.appendChild(style);
  renderSetup();
  document.getElementById('setup-screen').classList.remove('active');
});
</script>
</body>
</html>
